<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ö–∞—Ä—Ç–∞ –∫–µ–º–ø–∏–Ω–≥–∞</title>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Leaflet –∏ Swiper –ø–æ CDN –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/swiper/swiper-bundle.min.css"
    />
<!--     <link rel="stylesheet" href="lib/leaflet/leaflet.css" />
    <link rel="stylesheet" href="lib/swiper/swiper-bundle.min.css" /> -->

    <style>
      /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        overflow: hidden;
      }

      #map {
        width: 100vw;
        height: 100vh;
        z-index: 0;
        overflow: hidden;
      }

      .leaflet-container {
        background: #e0eced;
      }

      /* –°–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É Leaflet */
      .leaflet-control-attribution {
        display: none !important;
      }

      /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
      #sidebar {
        position: fixed;
        right: 0;
        top: 0;
        width: 100%;
        max-width: 400px;
        height: 100%;
        background: rgba(255, 255, 255, 0.98);
        padding: 20px;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.2);
        overflow-y: auto;
        z-index: 1000;
        transition: transform 0.3s ease-in-out;
        transform: translateX(100%);
        box-sizing: border-box;
      }

      #sidebar.active {
        transform: translateX(0);
      }

      .sidebar-close {
        display: none;
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 30px;
        font-weight: bold;
        color: #555;
        cursor: pointer;
        z-index: 1001;
      }

      .sidebar-close:hover {
        color: #000;
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
      @media (max-width: 768px) {
        #sidebar {
          transform: translateY(100%);
          bottom: 0;
          top: auto;
          width: 100%;
          max-width: 100%;
          max-height: 85%;
          border-radius: 20px 20px 0 0;
        }

        #sidebar.active {
          transform: translateY(0);
        }

        .sidebar-close {
          display: block;
        }
      }

      /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ */
      .custom-icon {
        background: none;
        border: none;
        font-size: 24px;
        text-align: center;
        line-height: 1;
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
      }

      /* –ò–∫–æ–Ω–∫–∞ —Å –Ω–æ–º–µ—Ä–æ–º –≤–Ω—É—Ç—Ä–∏ –ø–æ–ª–∏–≥–æ–Ω–∞ */
      .polygon-number-icon {
        background: rgba(255, 255, 255, 0.7);
        border: 1px solid #1a5fb4;
        color: #1a5fb4;
        font-weight: bold;
        text-align: center;
        border-radius: 50%;
        line-height: 28px; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
        font-size: 16px;
        cursor: pointer;
      }

      /* –°—Ç–∏–ª–∏ –ø–æ–ª–∏–≥–æ–Ω–æ–≤ */
      .polygon {
        fill-opacity: 0.2;
        fill-color: #4a90e2;
        color: #1a5fb4;
        weight: 2;
      }

      .polygon:hover {
        fill-opacity: 0.4;
        weight: 3;
      }

      /* –°–ª–∞–π–¥–µ—Ä Swiper */
      .swiper {
        width: 100%;
        height: 250px;
        margin-bottom: 20px;
        border-radius: 12px;
      }

      .swiper-slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        cursor: pointer;
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ Swiper */
      .swiper-pagination-bullet {
        background-color: #1a5fb4 !important;
      }
      .swiper-pagination-bullet-active {
        background-color: #4a90e2 !important;
      }

      /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
      .modal {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.92);
        -webkit-backdrop-filter: blur(5px);
        backdrop-filter: blur(5px);
      }

      .modal-content {
        margin: auto;
        display: block;
        max-width: 90%;
        max-height: 90%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border-radius: 8px;
      }

      /* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
      .modal-close {
        position: absolute;
        top: 20px;
        right: 35px;
        color: #f1f1f1;
        font-size: 40px;
        font-weight: bold;
        transition: 0.3s;
        cursor: pointer;
        z-index: 10000;
      }

      .modal-close:hover,
      .modal-close:focus {
        color: #bbb;
        text-decoration: none;
      }

      /* –°—Ç—Ä–µ–ª–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ */
      .modal-nav {
        cursor: pointer;
        position: absolute;
        top: 50%;
        width: auto;
        padding: 16px;
        margin-top: -50px;
        color: white;
        font-weight: bold;
        font-size: 30px;
        transition: 0.3s ease;
        border-radius: 0 3px 3px 0;
        user-select: none;
        background-color: rgba(0, 0, 0, 0.3);
      }

      .modal-nav:hover {
        background-color: rgba(0, 0, 0, 0.6);
      }

      .modal-prev {
        left: 0;
        border-radius: 3px 0 0 3px;
      }

      .modal-next {
        right: 0;
        border-radius: 0 3px 3px 0;
      }

      /* –¢–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
      #info-content h3 {
        margin-top: 0;
        font-size: 24px;
        color: #333;
      }

      #info-content p {
        margin: 10px 0;
        line-height: 1.6;
        color: #555;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div id="sidebar">
      <span class="sidebar-close">&times;</span>
      <div id="info-content">
        <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–µ</h2>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–æ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.</p>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π -->
    <div id="modal" class="modal">
      <span class="modal-close">&times;</span>
      <span class="modal-nav modal-prev">&#10094;</span>
      <span class="modal-nav modal-next">&#10095;</span>
      <img class="modal-content" id="modal-img" />
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Leaflet –∏ Swiper –ø–æ CDN -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
<!--     <script src="lib/leaflet/leaflet.js"></script>
    <script src="lib/swiper/swiper-bundle.min.js"></script> -->

    <script>
      // --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
      const map = L.map("map", {
        crs: L.CRS.Simple,
        minZoom: -2,
        maxZoom: 3,
        zoomSnap: 0.1,
        attributionControl: false,
      });

      // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç—ã
      const imageUrl = "map.png";
      const imageWidth = 4277;
      const imageHeight = 2669;
      const bounds = [
        [0, 0],
        [imageHeight, imageWidth],
      ];
      L.imageOverlay(imageUrl, bounds).addTo(map);

      // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
      let currentGalleryImages = [];
      let currentImageIndex = 0;
      const modal = document.getElementById("modal");
      const modalImg = document.getElementById("modal-img");
      const sidebar = document.getElementById("sidebar");
      const infoContent = document.getElementById("info-content");

      // --- –î–ê–ù–ù–´–ï ---

      // –î–∞–Ω–Ω—ã–µ –¥–ª—è —É—á–∞—Å—Ç–∫–æ–≤ (–ø–∞–ª–∞—Ç–æ–∫)
      const tents = [
        {
          id: 1,
          name: "–£—á–∞—Å—Ç–æ–∫ '–õ–µ—Å–Ω–æ–π'",
          coords: [
            [1200, 800],
            [1400, 800],
            [1400, 1200],
            [1200, 1200],
          ],
          area: "10x8 –º",
          shade: "—Å 10:00 –ø–æ 16:00",
          description:
            "–ü—Ä–æ—Å—Ç–æ—Ä–Ω—ã–π —É—á–∞—Å—Ç–æ–∫ —É –ª–µ—Å–∞, –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Å–µ–º—å–∏ –∏–∑ 4 —á–µ–ª–æ–≤–µ–∫. –†—è–¥–æ–º –µ—Å—Ç—å —Ä—É—á–µ–π.",
          images: ["1.png", "2.png"], // –¢–æ–ª—å–∫–æ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤
        },
        {
          id: 2,
          name: "–£—á–∞—Å—Ç–æ–∫ '–°–æ–ª–Ω–µ—á–Ω—ã–π'",
          coords: [
            [1800, 1500],
            [2000, 1500],
            [2000, 1800],
            [1800, 1800],
          ],
          area: "8x6 –º",
          shade: "–ø–æ—á—Ç–∏ –≤–µ—Å—å –¥–µ–Ω—å",
          description:
            "–£—é—Ç–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –ø–∞—Ä—ã, —Ö–æ—Ä–æ—à–æ –æ—Å–≤–µ—â–∞–µ—Ç—Å—è —Å–æ–ª–Ω—Ü–µ–º. –û—Ç–ª–∏—á–Ω—ã–π –≤–∏–¥ –Ω–∞ –∑–∞–∫–∞—Ç.",
          images: ["1.png", "2.png", "3.png"],
        },
        {
          id: 3,
          name: "–£—á–∞—Å—Ç–æ–∫ '–£–µ–¥–∏–Ω–µ–Ω–Ω—ã–π'",
          coords: [
            [500, 2000],
            [700, 2000],
            [700, 2200],
            [500, 2200],
          ],
          area: "7x7 –º",
          shade: "—É—Ç—Ä–µ–Ω–Ω—è—è —Ç–µ–Ω—å",
          description:
            "–¢–∏—Ö–æ–µ –º–µ—Å—Ç–æ –≤–¥–∞–ª–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö, –¥–ª—è —Ç–µ—Ö –∫—Ç–æ –ª—é–±–∏—Ç —É–µ–¥–∏–Ω–µ–Ω–∏–µ.",
          images: ["1.png"], // –£ —ç—Ç–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ –Ω–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
        },
      ];

      // –¢–æ—á–∫–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞ (POI)
      const points = [
        {
          id: "electricity",
          name: "–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ",
          coords: [200, 0],
          icon: "‚ö°",
          folder: "Electricity",
          description: "–î–æ—Å—Ç—É–ø–Ω—ã —Ä–æ–∑–µ—Ç–∫–∏ 220–í –¥–ª—è –∑–∞—Ä—è–¥–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤.",
          images: ["1.png"],
        },
        {
          id: "water",
          name: "–ò—Å—Ç–æ—á–Ω–∏–∫ –≤–æ–¥—ã",
          coords: [2550, 600],
          icon: "üíß",
          folder: "WaterSource",
          description: "–ß–∏—Å—Ç–∞—è –ø–∏—Ç—å–µ–≤–∞—è –≤–æ–¥–∞ –∏–∑ —Ä–æ–¥–Ω–∏–∫–∞.",
          images: ["1.png", "2.png"],
        },
        {
          id: "parking",
          name: "–ü–∞—Ä–∫–æ–≤–∫–∞",
          coords: [2600, 700],
          icon: "üöó",
          folder: "Parking",
          description: "–û—Ö—Ä–∞–Ω—è–µ–º–∞—è –ø–∞—Ä–∫–æ–≤–∫–∞ –¥–ª—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –≥–æ—Å—Ç–µ–π.",
          images: ["1.png"],
        },
        {
          id: "wc",
          name: "–î—É—à –∏ —Ç—É–∞–ª–µ—Ç",
          coords: [2650, 800],
          icon: "üöª",
          folder: "ShowerAndToilet",
          description: "–ö–æ–º—Ñ–æ—Ä—Ç–Ω—ã–µ –¥—É—à–µ–≤—ã–µ —Å –≥–æ—Ä—è—á–µ–π –≤–æ–¥–æ–π –∏ —á–∏—Å—Ç—ã–µ —Ç—É–∞–ª–µ—Ç—ã.",
          images: ["1.png", "2.png", "3.png"],
        },
      ];

      // --- –§–£–ù–ö–¶–ò–ò ---

      function fitMapToScreen() {
        map.fitBounds(bounds);
      }

      function createCustomIcon(iconText) {
        return L.divIcon({
          className: "custom-icon",
          html: iconText,
          iconSize: [32, 32],
          iconAnchor: [16, 32],
        });
      }

      function createNumberIcon(number) {
        return L.divIcon({
          className: "polygon-number-icon",
          html: `<span>${number}</span>`,
          iconSize: [30, 30],
          iconAnchor: [15, 15], // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∏–∫–æ–Ω–∫—É
        });
      }

      /**
       * –°–æ–∑–¥–∞–µ—Ç HTML –¥–ª—è Swiper —Å–ª–∞–π–¥–µ—Ä–∞
       * @param {string[]} images - –ú–∞—Å—Å–∏–≤ –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
       * @param {string} basePath - –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (e.g., 'images/1' or 'images/Parking')
       */
      function createSwiperHTML(images, basePath) {
        if (!images || images.length === 0) return "";
        const fullImagePaths = images.map((img) => `${basePath}/${img}`);

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–µ –ø—É—Ç–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        currentGalleryImages = fullImagePaths;

        return `
            <div class="swiper">
                <div class="swiper-wrapper">
                    ${fullImagePaths
                      .map(
                        (fullPath, index) => `
                        <div class="swiper-slide">
                            <img src="${fullPath}" alt="–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è" class="gallery-img" data-index="${index}" onerror="this.style.display='none'">
                        </div>`
                      )
                      .join("")}
                </div>
                <div class="swiper-pagination"></div>
            </div>`;
      }

      /**
       * –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –¥–ª—è –ª—é–±–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (–ø–∞–ª–∞—Ç–∫–∏ –∏–ª–∏ POI)
       * @param {object} item - –û–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏
       */
      function updateSidebar(item) {
        const isTent = !!item.area; // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ–±—ä–µ–∫—Ç –ø–∞–ª–∞—Ç–∫–æ–π –ø–æ –Ω–∞–ª–∏—á–∏—é —Å–≤–æ–π—Å—Ç–≤–∞ 'area'
        const basePath = isTent ? `images/${item.id}` : `images/${item.folder}`;

        const swiperHTML = createSwiperHTML(item.images, basePath);

        let detailsHTML = `<p>${item.description}</p>`;
        if (isTent) {
          detailsHTML = `
                <p><strong>–ü–ª–æ—â–∞–¥—å:</strong> ${item.area}</p>
                <p><strong>–í —Ç–µ–Ω–∏:</strong> ${item.shade}</p>
                <p>${item.description}</p>
            `;
        }

        infoContent.innerHTML = `
            <h3>${item.name}</h3>
            ${detailsHTML}
            ${swiperHTML}`;

        if (item.images && item.images.length > 0) {
          new Swiper(".swiper", {
            pagination: { el: ".swiper-pagination", clickable: true },
            loop: item.images.length > 1,
          });
        }
        sidebar.classList.add("active");
      }

      function showImage(index) {
        if (
          !currentGalleryImages ||
          index < 0 ||
          index >= currentGalleryImages.length
        ) {
          return;
        }
        currentImageIndex = index;
        modalImg.src = currentGalleryImages[currentImageIndex];
        modal.style.display = "flex";

        document.querySelector(".modal-prev").style.display =
          index > 0 && currentGalleryImages.length > 1 ? "block" : "none";
        document.querySelector(".modal-next").style.display =
          index < currentGalleryImages.length - 1 &&
          currentGalleryImages.length > 1
            ? "block"
            : "none";
      }

      function showNextImage() {
        showImage(currentImageIndex + 1);
      }
      function showPrevImage() {
        showImage(currentImageIndex - 1);
      }
      function closeModal() {
        modal.style.display = "none";
      }

      // --- –î–û–ë–ê–í–õ–ï–ù–ò–ï –≠–õ–ï–ú–ï–ù–¢–û–í –ù–ê –ö–ê–†–¢–£ ---

      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—á–µ–∫ –∏–Ω—Ç–µ—Ä–µ—Å–∞
      points.forEach((point) => {
        L.marker(point.coords, { icon: createCustomIcon(point.icon) })
          .addTo(map)
          .bindPopup(`<strong>${point.name}</strong>`)
          .on("click", (e) => {
            L.DomEvent.stopPropagation(e);
            updateSidebar(point);
          });
      });

      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–∏–≥–æ–Ω–æ–≤ (–ø–∞–ª–∞—Ç–æ–∫) –∏ –∏—Ö –Ω–æ–º–µ—Ä–æ–≤
      tents.forEach((tent) => {
        const polygon = L.polygon(tent.coords, { className: "polygon" }).addTo(
          map
        );
        const center = polygon.getBounds().getCenter();
        const numberMarker = L.marker(center, {
          icon: createNumberIcon(tent.id),
        }).addTo(map);

        const clickHandler = (e) => {
          L.DomEvent.stopPropagation(e);
          updateSidebar(tent);
        };

        polygon.on("click", clickHandler);
        numberMarker.on("click", clickHandler);
      });

      // --- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ---

      fitMapToScreen();
      window.addEventListener("resize", fitMapToScreen);

      document.querySelector(".sidebar-close").addEventListener("click", () => {
        sidebar.classList.remove("active");
      });

      map.on("click", () => {
        sidebar.classList.remove("active");
      });

      sidebar.addEventListener("click", (e) => {
        if (e.target && e.target.classList.contains("gallery-img")) {
          const index = parseInt(e.target.dataset.index, 10);
          showImage(index);
        }
      });

      document
        .querySelector(".modal-close")
        .addEventListener("click", closeModal);
      document
        .querySelector(".modal-next")
        .addEventListener("click", showNextImage);
      document
        .querySelector(".modal-prev")
        .addEventListener("click", showPrevImage);

      modal.addEventListener("click", (e) => {
        if (e.target === modal) {
          closeModal();
        }
      });

      document.addEventListener("keydown", (e) => {
        if (modal.style.display === "flex") {
          if (e.key === "Escape") closeModal();
          if (e.key === "ArrowRight") showNextImage();
          if (e.key === "ArrowLeft") showPrevImage();
        }
      });
    </script>
  </body>
</html>
